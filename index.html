<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelæ•°æ®å¯è§†åŒ–</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .upload-container {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            text-align: center;
        }
        .upload-area {
            border: 2px dashed #2196F3;
            border-radius: 8px;
            padding: 50px 20px;
            margin: 20px auto;
            max-width: 800px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover {
            background-color: #f9f9f9;
        }
        .folder-icon {
            font-size: 50px;
            color: #FFC107;
            margin-bottom: 20px;
        }
        .charts-options {
            margin: 20px 0;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
            display: none;
        }
        .chart-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        .chart-option {
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #f9f9f9;
            min-width: 120px;
            text-align: center;
            position: relative;
        }
        .chart-option:hover {
            background-color: #e3f2fd;
            border-color: #2196F3;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .chart-option.selected {
            background-color: #2196F3;
            color: white;
            border-color: #0b7dda;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(33,150,243,0.3);
        }
        .chart-option i {
            display: block;
            font-size: 24px;
            margin-bottom: 8px;
        }
        .selection-help {
            margin: 15px 0;
            padding: 10px;
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
            border-radius: 4px;
        }
        .charts-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }
        .chart-box {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            width: calc(100% - 30px);
            min-height: 400px;
            margin-bottom: 20px;
            display: none;
        }
        .chart {
            width: 100%;
            height: 400px;
        }
        .btn {
            background-color: #2196F3;
            border: none;
            color: white;
            padding: 12px 25px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 15px 5px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }
        .btn:hover {
            background-color: #0b7dda;
        }
        .btn:disabled {
            background-color: #2196F3;
            cursor: pointer;
            opacity: 0.8;
        }
        .btn.secondary {
            background-color: #4CAF50;
        }
        .btn.secondary:hover {
            background-color: #45a049;
        }
        .btn.secondary.active {
            background-color: #4CAF50;
            transform: scale(1.05);
            transition: all 0.3s;
        }
        .btn.secondary:disabled {
            background-color: #9e9e9e;
            cursor: pointer;
            opacity: 0.8;
        }
        .file-input {
            display: none;
        }
        .upload-text {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
        .data-preview {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        .column-selector {
            margin: 20px 0;
            display: none;
        }
        .column-group {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .column-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        #file-name {
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        .step {
            padding: 10px 20px;
            margin: 0 5px;
            background-color: #e0e0e0;
            border-radius: 4px;
            color: #333;
        }
        .step.active {
            background-color: #2196F3;
            color: white;
        }
        .error-msg {
            color: #f44336;
            margin: 10px 0;
            padding: 10px;
            background-color: #ffebee;
            border-radius: 4px;
            display: none;
        }
        .flash-notice {
            background-color: #ffeb3b;
            color: #000;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            opacity: 0.9;
            border: 2px dashed #ff9800;
        }
        .flash {
            animation: flashAnimation 1.5s ease-in-out 2;
        }
        @keyframes flashAnimation {
            0% { opacity: 0.9; }
            50% { opacity: 0.3; }
            100% { opacity: 0.9; }
        }
        .selection-help {
            background-color: #e3f2fd;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid #2196F3;
        }
        
        .column-description {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        .column-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            align-items: center;
        }
        
        .btn.secondary {
            background-color: #9e9e9e;
        }
        
        .btn.secondary:hover {
            background-color: #757575;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Excelæ•°æ®å¯è§†åŒ–</h1>
    </div>

    <div class="step-indicator">
        <div class="step active">1. ä¸Šä¼ Excel</div>
        <div class="step">2. é€‰æ‹©å›¾è¡¨ç±»å‹</div>
        <div class="step">3. é€‰æ‹©æ•°æ®åˆ—</div>
        <div class="step">4. æŸ¥çœ‹ç»“æœ</div>
    </div>

    <div class="upload-container" id="upload-container">
        <div class="upload-area" id="upload-area">
            <div class="folder-icon">ğŸ“</div>
            <h2>é€‰æ‹©Excelæ–‡ä»¶</h2>
            <p class="upload-text">æ”¯æŒ.xlsxå’Œ.xlsæ ¼å¼æ–‡ä»¶</p>
            <p class="upload-text">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„</p>
            <input type="file" id="file-upload" class="file-input" accept=".xlsx, .xls">
        </div>
        <div id="file-name"></div>
        <div class="error-msg" id="error-msg"></div>
    </div>

    <div class="data-preview" id="data-preview">
        <h3>æ•°æ®é¢„è§ˆ</h3>
        <div id="preview-table"></div>
    </div>

    <div class="charts-options" id="charts-options">
        <h3>è¯·é€‰æ‹©è¦ç”Ÿæˆçš„å›¾è¡¨ç±»å‹</h3>
        <div class="selection-help">ç‚¹å‡»ä¸‹æ–¹å›¾è¡¨ç±»å‹è¿›è¡Œé€‰æ‹©ï¼ˆå¯å¤šé€‰ï¼‰ï¼Œç„¶åç‚¹å‡»"ç»§ç»­"æŒ‰é’®</div>
        <div class="chart-selection">
            <div class="chart-option" data-type="bar">
                <i>ğŸ“Š</i>
                æŸ±çŠ¶å›¾
            </div>
            <div class="chart-option" data-type="pie">
                <i>ğŸ¥§</i>
                é¥¼å›¾
            </div>
            <div class="chart-option" data-type="line">
                <i>ğŸ“ˆ</i>
                æŠ˜çº¿å›¾
            </div>
            <div class="chart-option" data-type="scatter">
                <i>ğŸ”¢</i>
                æ•£ç‚¹å›¾
            </div>
            <div class="chart-option" data-type="radar">
                <i>ğŸ“¡</i>
                é›·è¾¾å›¾
            </div>
            <div class="chart-option" data-type="area">
                <i>ğŸ“‰</i>
                é¢ç§¯å›¾
            </div>
            <div class="chart-option" data-type="sunburst">
                <i>â˜€ï¸</i>
                æ—­æ—¥å›¾
            </div>
        </div>
        <button id="continue-to-columns-btn" class="btn secondary">ç»§ç»­</button>
    </div>

    <div class="column-selector" id="column-selector">
        <h3>é€‰æ‹©æ•°æ®åˆ—</h3>
        
        <div class="selection-help">
            è¯·é€‰æ‹©è¦ç”¨äºå›¾è¡¨çš„æ•°æ®åˆ—ã€‚å¯¹äºæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾å’Œæ•£ç‚¹å›¾ï¼Œéœ€è¦é€‰æ‹©Xè½´å’ŒYè½´çš„æ•°æ®ï¼›å¯¹äºé¥¼å›¾ï¼Œåªéœ€é€‰æ‹©ä¸€åˆ—æ•°æ®ã€‚
        </div>
        
        <div class="column-group">
            <label id="category-label" for="category-column">Xè½´æ•°æ®åˆ—ï¼ˆç±»åˆ«/åç§°ï¼‰:</label>
            <select id="category-column" class="column-select"></select>
            <div class="column-description">Xè½´é€šå¸¸ç”¨äºæ˜¾ç¤ºç±»åˆ«åç§°ï¼Œå¦‚äº§å“ã€æ—¥æœŸã€åœ°åŒºç­‰</div>
        </div>
        
        <div class="column-group" id="value-column-group">
            <label for="value-column">Yè½´æ•°æ®åˆ—ï¼ˆæ•°å€¼ï¼‰:</label>
            <select id="value-column" class="column-select"></select>
            <div class="column-description">Yè½´é€šå¸¸ç”¨äºæ˜¾ç¤ºæ•°å€¼ï¼Œå¦‚é”€å”®é¢ã€æ•°é‡ã€æ¯”ç‡ç­‰</div>
        </div>
        
        <div class="column-actions">
            <button id="swap-axes-btn" class="btn secondary" title="äº¤æ¢Xè½´å’ŒYè½´æ•°æ®">
                <span>â†”ï¸ äº¤æ¢XYè½´</span>
            </button>
            <button id="generate-btn" class="btn">ç”Ÿæˆå›¾è¡¨</button>
        </div>
    </div>

    <div class="charts-container" id="charts-container">
        <div class="chart-box" id="bar-chart-container">
            <h3>æŸ±çŠ¶å›¾</h3>
            <div id="bar-chart" class="chart"></div>
        </div>
        <div class="chart-box" id="pie-chart-container">
            <h3>é¥¼å›¾</h3>
            <div id="pie-chart" class="chart"></div>
        </div>
        <div class="chart-box" id="line-chart-container">
            <h3>æŠ˜çº¿å›¾</h3>
            <div id="line-chart" class="chart"></div>
        </div>
        <div class="chart-box" id="scatter-chart-container">
            <h3>æ•£ç‚¹å›¾</h3>
            <div id="scatter-chart" class="chart"></div>
        </div>
        <div class="chart-box" id="radar-chart-container">
            <h3>é›·è¾¾å›¾</h3>
            <div id="radar-chart" class="chart"></div>
        </div>
        <div class="chart-box" id="area-chart-container">
            <h3>é¢ç§¯å›¾</h3>
            <div id="area-chart" class="chart"></div>
        </div>
        <div class="chart-box" id="sunburst-chart-container">
            <h3>æ—­æ—¥å›¾</h3>
            <div id="sunburst-chart" class="chart"></div>
        </div>
    </div>

    <script>
        let workbook = null;
        let sheetData = null;
        let headers = [];
        let selectedChartTypes = new Set();
        
        // æ–‡ä»¶ä¸Šä¼ åŒºåŸŸç‚¹å‡»äº‹ä»¶
        document.getElementById('upload-area').addEventListener('click', function() {
            document.getElementById('file-upload').click();
        });
        
        // æ‹–æ”¾æ–‡ä»¶åŠŸèƒ½
        const uploadArea = document.getElementById('upload-area');
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = '#0b7dda';
            uploadArea.style.backgroundColor = '#f0f8ff';
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = '#2196F3';
            uploadArea.style.backgroundColor = 'white';
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = '#2196F3';
            uploadArea.style.backgroundColor = 'white';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    document.getElementById('file-upload').files = files;
                    handleFileUpload(file);
                } else {
                    showError('è¯·ä¸Šä¼ Excelæ–‡ä»¶ (.xlsx æˆ– .xls æ ¼å¼)');
                }
            }
        });
        
        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('file-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            handleFileUpload(file);
        });
        
        function handleFileUpload(file) {
            document.getElementById('file-name').textContent = 'æ­£åœ¨å¤„ç†: ' + file.name;
            document.getElementById('error-msg').style.display = 'none';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    workbook = XLSX.read(data, { type: 'array', cellDates: true, cellNF: true, cellText: false });
                    
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // è½¬æ¢ä¸ºJSONï¼Œä¿æŒæ‰€æœ‰æ•°æ®ç±»å‹
                    sheetData = XLSX.utils.sheet_to_json(worksheet, { 
                        header: 1, 
                        raw: false,
                        defval: ''
                    });
                    
                    if (sheetData.length > 0) {
                        // è¿‡æ»¤æ‰ç©ºè¡Œ
                        sheetData = sheetData.filter(row => row.some(cell => cell !== ''));
                        
                        if (sheetData.length > 0) {
                            headers = sheetData[0].map((header, index) => {
                                return header || `åˆ— ${index+1}`;
                            });
                            
                            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
                            document.querySelectorAll('.step')[0].classList.remove('active');
                            document.querySelectorAll('.step')[1].classList.add('active');
                            
                            // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
                            document.getElementById('data-preview').style.display = 'block';
                            displayDataPreview(sheetData);
                            
                            // æ˜¾ç¤ºå›¾è¡¨é€‰æ‹©åŒºåŸŸ
                            document.getElementById('charts-options').style.display = 'block';
                            document.getElementById('charts-options').scrollIntoView({ behavior: 'smooth' });
                            
                            // æ˜¾ç¤ºæ˜æ˜¾çš„æç¤º
                            const notice = document.createElement('div');
                            notice.className = 'flash-notice';
                            notice.textContent = 'ğŸ‘† è¯·é€‰æ‹©æ‚¨æƒ³è¦ç”Ÿæˆçš„å›¾è¡¨ç±»å‹';
                            document.getElementById('charts-options').prepend(notice);
                            
                            // é—ªçƒåŠ¨ç”»ï¼Œå¼•èµ·ç”¨æˆ·æ³¨æ„
                            setTimeout(() => {
                                if (document.querySelector('.flash-notice')) {
                                    document.querySelector('.flash-notice').classList.add('flash');
                                }
                            }, 300);
                            
                            document.getElementById('file-name').textContent = 'å·²ä¸Šä¼ : ' + file.name;
                        } else {
                            showError('Excelæ–‡ä»¶æ²¡æœ‰æœ‰æ•ˆæ•°æ®');
                        }
                    } else {
                        showError('Excelæ–‡ä»¶æ²¡æœ‰æ•°æ®');
                    }
                } catch (error) {
                    console.error('è§£æExcelæ–‡ä»¶å‡ºé”™:', error);
                    showError('è§£æExcelæ–‡ä»¶å‡ºé”™: ' + error.message);
                }
            };
            reader.onerror = function() {
                showError('è¯»å–æ–‡ä»¶å‡ºé”™');
            };
            reader.readAsArrayBuffer(file);
        }
        
        function showError(message) {
            const errorElement = document.getElementById('error-msg');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            document.getElementById('file-name').textContent = 'å¤„ç†å¤±è´¥';
        }
        
        // è®¾ç½®åˆ—é€‰æ‹©å™¨
        function setupColumnSelector(headers) {
            const categorySelect = document.getElementById('category-column');
            const valueSelect = document.getElementById('value-column');
            
            categorySelect.innerHTML = '';
            valueSelect.innerHTML = '';
            
            headers.forEach((header, index) => {
                const categoryOption = document.createElement('option');
                categoryOption.value = index;
                categoryOption.textContent = header;
                categorySelect.appendChild(categoryOption);
                
                const valueOption = document.createElement('option');
                valueOption.value = index;
                valueOption.textContent = header;
                valueSelect.appendChild(valueOption);
            });
            
            // é»˜è®¤é€‰æ‹©ç¬¬ä¸€åˆ—ä½œä¸ºç±»åˆ«ï¼Œç¬¬äºŒåˆ—ä½œä¸ºæ•°å€¼
            if (headers.length > 1) {
                categorySelect.value = 0;
                valueSelect.value = 1;
            }
        }
        
        // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
        function displayDataPreview(data) {
            const table = document.createElement('table');
            const maxRows = Math.min(data.length, 10); // é™åˆ¶é¢„è§ˆè¡Œæ•°
            
            for (let i = 0; i < maxRows; i++) {
                const row = document.createElement('tr');
                
                // åˆ›å»ºå•å…ƒæ ¼
                for (let j = 0; j < data[i].length; j++) {
                    const cell = i === 0 ? document.createElement('th') : document.createElement('td');
                    cell.textContent = data[i][j];
                    row.appendChild(cell);
                }
                
                table.appendChild(row);
            }
            
            const previewTable = document.getElementById('preview-table');
            previewTable.innerHTML = '';
            previewTable.appendChild(table);
        }
        
        // ä¿®æ”¹æ•°æ®åˆ—éªŒè¯å’Œè½¬æ¢å‡½æ•°
        function isNumeric(str) {
            // å¤„ç†å„ç§æ•°å­—æ ¼å¼ï¼ŒåŒ…æ‹¬æ•´æ•°ã€å°æ•°ã€ç§‘å­¦è®¡æ•°æ³•
            if (str === null || str === undefined || str === '') return false;
            
            // å¦‚æœå·²ç»æ˜¯æ•°å­—ç±»å‹ï¼Œç›´æ¥è¿”å›true
            if (typeof str === 'number') return true;
            
            // å°è¯•è½¬æ¢å­—ç¬¦ä¸²
            str = String(str).trim();
            
            // ç‰¹æ®Šå¤„ç†ç™¾åˆ†æ¯”æ ¼å¼
            if (str.endsWith('%')) {
                str = str.slice(0, -1);
            }
            
            // å¤„ç†Excelå¯èƒ½æœ‰çš„åƒä½åˆ†éš”ç¬¦
            str = str.replace(/,/g, '');
            
            // å…è®¸å°æ•°ç‚¹ã€è´Ÿå·å’Œç§‘å­¦è®¡æ•°æ³•
            return !isNaN(parseFloat(str));
        }
        
        // æ·»åŠ æŒ‰é’®é€»è¾‘ï¼šç¡®ä¿æ°¸ä¸ç¦ç”¨ç»§ç»­æŒ‰é’®
        document.getElementById('continue-to-columns-btn').disabled = false;
        
        // å›¾è¡¨ç±»å‹é€‰æ‹©
        document.querySelectorAll('.chart-option').forEach(option => {
            option.addEventListener('click', function() {
                const chartType = this.getAttribute('data-type');
                
                if (this.classList.contains('selected')) {
                    this.classList.remove('selected');
                    selectedChartTypes.delete(chartType);
                } else {
                    this.classList.add('selected');
                    selectedChartTypes.add(chartType);
                }
            });
        });
        
        // æ·»åŠ ä»å›¾è¡¨é€‰æ‹©åˆ°æ•°æ®åˆ—é€‰æ‹©çš„è¿‡æ¸¡æŒ‰é’®äº‹ä»¶
        document.getElementById('continue-to-columns-btn').addEventListener('click', function() {
            if (selectedChartTypes.size === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ç§å›¾è¡¨ç±»å‹');
                return;
            }
            
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            document.querySelectorAll('.step')[1].classList.remove('active');
            document.querySelectorAll('.step')[2].classList.add('active');
            
            // è®¾ç½®åˆ—é€‰æ‹©å™¨
            setupColumnSelector(headers);
            
            // é¥¼å›¾æ¨¡å¼ç‰¹æ®Šå¤„ç†
            const onlyPieSelected = selectedChartTypes.size === 1 && selectedChartTypes.has('pie');
            if (onlyPieSelected) {
                document.getElementById('value-column-group').style.display = 'none';
                document.getElementById('swap-axes-btn').style.display = 'none';
                document.getElementById('category-label').textContent = 'æ•°æ®åˆ—ï¼ˆé¥¼å›¾æ•°æ®ï¼‰:';
                document.querySelector('.selection-help').textContent = 'é¥¼å›¾åªéœ€è¦é€‰æ‹©ä¸€åˆ—æ•°æ®ï¼Œç›¸åŒåç§°çš„æ•°æ®å°†è¢«è‡ªåŠ¨åˆå¹¶ã€‚';
            } else {
                document.getElementById('value-column-group').style.display = 'block';
                document.getElementById('swap-axes-btn').style.display = 'inline-block';
                document.getElementById('category-label').textContent = 'Xè½´æ•°æ®åˆ—ï¼ˆç±»åˆ«/åç§°ï¼‰:';
                document.querySelector('.selection-help').textContent = 'è¯·é€‰æ‹©è¦ç”¨äºå›¾è¡¨çš„æ•°æ®åˆ—ã€‚å¯¹äºæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾å’Œæ•£ç‚¹å›¾ï¼Œéœ€è¦é€‰æ‹©Xè½´å’ŒYè½´çš„æ•°æ®ã€‚';
            }
            
            document.getElementById('column-selector').style.display = 'block';
            document.getElementById('column-selector').scrollIntoView({ behavior: 'smooth' });
            
            // é—ªçƒåŠ¨ç”»æç¤º
            if (document.querySelector('.flash-notice')) {
                document.querySelector('.flash-notice').remove();
            }
            
            const notice = document.createElement('div');
            notice.className = 'flash-notice';
            notice.textContent = 'ğŸ‘‡ è¯·é€‰æ‹©æ•°æ®åˆ—';
            document.getElementById('column-selector').prepend(notice);
            
            // é—ªçƒåŠ¨ç”»ï¼Œå¼•èµ·ç”¨æˆ·æ³¨æ„
            setTimeout(() => {
                if (document.querySelector('.flash-notice')) {
                    document.querySelector('.flash-notice').classList.add('flash');
                }
            }, 300);
        });
        
        // ç”Ÿæˆå›¾è¡¨æŒ‰é’®äº‹ä»¶
        document.getElementById('generate-btn').addEventListener('click', function() {
            if (!sheetData || sheetData.length <= 1) {
                showError('æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®è¿›è¡Œåˆ†æ');
                return;
            }
            
            const categoryIndex = parseInt(document.getElementById('category-column').value);
            const valueIndex = parseInt(document.getElementById('value-column').value);
            
            // éªŒè¯æ˜¯å¦å¯ä»¥ä»é€‰å®šçš„åˆ—ç”Ÿæˆå›¾è¡¨
            const categories = [];
            const values = [];
            
            // ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼ˆè·³è¿‡è¡¨å¤´ï¼‰æå–æ•°æ®
            for (let i = 1; i < sheetData.length; i++) {
                const row = sheetData[i];
                if (row.length > categoryIndex) {
                    categories.push(row[categoryIndex] || `é¡¹ç›® ${i}`);
                    
                    // é¥¼å›¾ç‰¹æ®Šå¤„ç†ï¼ˆåªéœ€è¦ä¸€åˆ—æ•°æ®ï¼‰
                    const onlyPieSelected = selectedChartTypes.size === 1 && selectedChartTypes.has('pie');
                    if (onlyPieSelected) {
                        // å¯¹äºé¥¼å›¾ï¼Œæˆ‘ä»¬ä½¿ç”¨ç±»åˆ«åˆ—çš„æ•°æ®ä½œä¸ºå€¼
                        // å°è¯•æå–æ•°å€¼ï¼Œå¦‚æœä¸æ˜¯æ•°å­—åˆ™ä½¿ç”¨1ä½œä¸ºé»˜è®¤å€¼ï¼ˆç­‰ä»½ï¼‰
                        const rawValue = row[categoryIndex];
                        values.push(isNumeric(rawValue) ? parseFloat(rawValue) : 1);
                    } else if (row.length > valueIndex) {
                        // å¯¹äºå…¶ä»–å›¾è¡¨ï¼Œä½¿ç”¨æŒ‡å®šçš„å€¼åˆ—
                        values.push(row[valueIndex]);
                    }
                }
            }
            
            // æ”¹è¿›æ•°å€¼æ£€æµ‹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºExcelä¸­çš„æ•°å­—ç±»å‹
            const hasValidData = values.some(val => {
                // å¤„ç†Excelå¯èƒ½è¾“å‡ºçš„å„ç§æ•°å­—æ ¼å¼
                if (val === null || val === undefined) return false;
                return true; // ä»»ä½•å€¼éƒ½æ¥å—ï¼Œåç»­ä¼šå°è¯•è½¬æ¢
            });
            
            if (!hasValidData || values.length === 0) {
                showError('é€‰æ‹©çš„æ•°æ®åˆ—æ²¡æœ‰æœ‰æ•ˆæ•°æ®');
                return;
            }
            
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            document.querySelectorAll('.step')[2].classList.remove('active');
            document.querySelectorAll('.step')[3].classList.add('active');
            
            // éšè—æ‰€æœ‰å›¾è¡¨å®¹å™¨
            document.querySelectorAll('.chart-box').forEach(box => {
                box.style.display = 'none';
            });
            
            // å‡†å¤‡æ•°æ®ï¼Œè½¬æ¢æ•°å€¼
            const numericValues = [];
            for (let i = 0; i < values.length; i++) {
                const rawValue = values[i];
                // æ›´å®½æ¾çš„æ•°å€¼è½¬æ¢
                let numValue;
                try {
                    numValue = typeof rawValue === 'number' ? rawValue : 
                              isNumeric(rawValue) ? parseFloat(rawValue) : 
                              (rawValue && typeof rawValue === 'string' && rawValue.trim() !== '') ? 1 : 0;
                } catch (e) {
                    numValue = 1; // é»˜è®¤å€¼
                }
                numericValues.push(numValue);
            }
            
            // æ ¹æ®é€‰æ‹©ç”Ÿæˆå›¾è¡¨
            if (selectedChartTypes.has('bar')) {
                document.getElementById('bar-chart-container').style.display = 'block';
                generateBarChart(categories, numericValues);
            }
            
            if (selectedChartTypes.has('pie')) {
                document.getElementById('pie-chart-container').style.display = 'block';
                
                // é¥¼å›¾ç‰¹æ®Šå¤„ç†
                const onlyPieSelected = selectedChartTypes.size === 1 && selectedChartTypes.has('pie');
                if (onlyPieSelected) {
                    // ä½¿ç”¨ç±»åˆ«ä½œä¸ºåç§°ï¼Œæ•°å€¼ä½œä¸ºå€¼
                    generatePieChart(categories, numericValues);
                } else {
                    generatePieChart(categories, numericValues);
                }
            }
            
            if (selectedChartTypes.has('line')) {
                document.getElementById('line-chart-container').style.display = 'block';
                generateLineChart(categories, numericValues);
            }
            
            if (selectedChartTypes.has('scatter')) {
                document.getElementById('scatter-chart-container').style.display = 'block';
                generateScatterChart(categories, numericValues);
            }
            
            // æ·»åŠ æ–°å›¾è¡¨ç±»å‹çš„ç”Ÿæˆ
            if (selectedChartTypes.has('radar')) {
                document.getElementById('radar-chart-container').style.display = 'block';
                generateRadarChart(categories, numericValues);
            }
            
            if (selectedChartTypes.has('area')) {
                document.getElementById('area-chart-container').style.display = 'block';
                generateAreaChart(categories, numericValues);
            }
            
            if (selectedChartTypes.has('sunburst')) {
                document.getElementById('sunburst-chart-container').style.display = 'block';
                generateSunburstChart(categories, numericValues);
            }
            
            // æ»šåŠ¨åˆ°å›¾è¡¨åŒºåŸŸ
            document.getElementById('charts-container').scrollIntoView({ behavior: 'smooth' });
        });
        
        // æ·»åŠ å¤„ç†å°æ•°ç²¾åº¦çš„å‡½æ•°
        function fixPrecision(num) {
            // å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åè§£æä¸ºæµ®ç‚¹æ•°ï¼Œé¿å…äºŒè¿›åˆ¶è¡¨ç¤ºç²¾åº¦é—®é¢˜
            // ä¿ç•™4ä½å°æ•°ï¼Œé¿å…ç±»ä¼¼0.1 + 0.2 != 0.3çš„é—®é¢˜
            return parseFloat(parseFloat(num).toFixed(4));
        }
        
        // åœ¨åˆå¹¶ç›¸åŒç±»åˆ«æ•°æ®æ—¶ï¼Œä¿®æ”¹ç´¯åŠ é€»è¾‘ï¼Œä½¿ç”¨ç²¾ç¡®è®¡ç®—
        function mergeData(categories, values) {
            const dataMap = new Map();
            for (let i = 0; i < categories.length; i++) {
                const category = categories[i];
                // ç¡®ä¿å€¼æ˜¯æ•°å­—
                const value = typeof values[i] === 'number' ? values[i] : parseFloat(values[i]) || 0;
                
                if (dataMap.has(category)) {
                    // ä½¿ç”¨ç²¾ç¡®è®¡ç®—ç´¯åŠ å€¼
                    const currentValue = dataMap.get(category);
                    dataMap.set(category, fixPrecision(currentValue + value));
                } else {
                    // æ–°ç±»åˆ«ï¼Œè®¾ç½®åˆå§‹å€¼
                    dataMap.set(category, fixPrecision(value));
                }
            }
            
            // å°†Mapè½¬æ¢ä¸ºæ‰€éœ€çš„æ•°æ®æ ¼å¼
            const mergedCategories = [];
            const mergedValues = [];
            
            dataMap.forEach((value, category) => {
                mergedCategories.push(category);
                mergedValues.push(value);
            });
            
            return { categories: mergedCategories, values: mergedValues };
        }
        
        // ç”ŸæˆæŸ±çŠ¶å›¾
        function generateBarChart(categories, values) {
            const chartDom = document.getElementById('bar-chart');
            const myChart = echarts.init(chartDom);
            
            // ä½¿ç”¨ä¿®æ”¹åçš„å‡½æ•°åˆå¹¶æ•°æ®
            const mergedData = mergeData(categories, values);
            const mergedCategories = mergedData.categories;
            const mergedValues = mergedData.values;
            
            // æŸ±çŠ¶å›¾é¢œè‰²è®¾è®¡
            const colorList = [
                '#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de',
                '#3ba272', '#fc8452', '#9a60b4', '#ea7ccc', '#6e7074'
            ];
            
            // è·å–åˆ—æ ‡ç­¾ä½œä¸ºè½´åç§°
            const categoryColumnIndex = parseInt(document.getElementById('category-column').value);
            const valueColumnIndex = parseInt(document.getElementById('value-column').value);
            const xAxisName = headers[categoryColumnIndex] || 'Xè½´';
            const yAxisName = headers[valueColumnIndex] || 'Yè½´';
            
            const option = {
                title: {
                    text: 'æ•°æ®åˆ†æç»“æœ',
                    left: 'center',
                    textStyle: {
                        fontSize: 16
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        const param = params[0];
                        return `${param.name}: ${param.value} ${yAxisName}`;
                    }
                },
                grid: {
                    left: '5%',
                    right: '10%',  // å¢åŠ å³ä¾§ç©ºé—´ï¼Œä¸ºYè½´åç§°ç•™å‡ºä½ç½®
                    bottom: '10%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: mergedCategories,
                    axisLabel: {
                        rotate: 45,
                        interval: 0,
                        fontSize: 10,
                        color: '#666'
                    },
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#ccc'
                        }
                    },
                    name: xAxisName,
                    nameLocation: 'end',  // ä¿®æ”¹ä¸ºæœ«ç«¯æ˜¾ç¤º
                    nameGap: 5,
                    nameTextStyle: {
                        fontWeight: 'bold',
                        fontSize: 12,
                        align: 'right',
                        verticalAlign: 'top'
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLine: {
                        show: true,
                        lineStyle: {
                            color: '#ccc'
                        }
                    },
                    splitLine: {
                        lineStyle: {
                            type: 'dashed',
                            color: '#eee'
                        }
                    },
                    name: yAxisName,
                    nameLocation: 'end',  // ä¿®æ”¹ä¸ºæœ«ç«¯æ˜¾ç¤º
                    nameGap: 15,
                    nameTextStyle: {
                        fontWeight: 'bold',
                        fontSize: 12,
                        padding: [0, 0, 5, 0]  // ä¸Šå³ä¸‹å·¦çš„å†…è¾¹è·
                    }
                },
                series: [{
                    name: yAxisName,
                    type: 'bar',
                    data: mergedValues.map((value, index) => {
                        return {
                            value: value,
                            itemStyle: {
                                color: colorList[index % colorList.length]
                            }
                        };
                    }),
                    barWidth: '50%',
                    itemStyle: {
                        borderRadius: [5, 5, 0, 0]
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0,0,0,0.3)'
                        }
                    },
                    label: {
                        show: true,
                        position: 'top',
                        formatter: '{c}',
                        fontSize: 10
                    },
                    showBackground: true,
                    backgroundStyle: {
                        color: 'rgba(180, 180, 180, 0.1)'
                    }
                }]
            };
            
            myChart.setOption(option);
            
            // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜å›¾è¡¨
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // ç”Ÿæˆé¥¼å›¾
        function generatePieChart(categories, values) {
            const chartDom = document.getElementById('pie-chart');
            const myChart = echarts.init(chartDom);
            
            // ä½¿ç”¨ä¿®æ”¹åçš„å‡½æ•°åˆå¹¶æ•°æ®
            const mergedData = mergeData(categories, values);
            const mergedCategories = mergedData.categories;
            const mergedValues = mergedData.values;
            
            // å°†æ•°æ®è½¬æ¢ä¸ºé¥¼å›¾æ ¼å¼
            const pieData = mergedCategories.map((name, index) => {
                return { name, value: mergedValues[index] };
            });
            
            // è·å–åˆ—æ ‡ç­¾ä½œä¸ºæ•°æ®åç§°
            const categoryColumnIndex = parseInt(document.getElementById('category-column').value);
            const categoryName = headers[categoryColumnIndex] || 'æ•°æ®';
            
            const option = {
                title: {
                    text: 'æ•°æ®åˆ†æç»“æœ',
                    left: 'center',
                    textStyle: {
                        fontSize: 16
                    },
                    subtext: `æ•°æ®æ¥æº: ${categoryName}`
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    type: 'scroll'
                },
                series: [{
                    name: categoryName,
                    type: 'pie',
                    radius: '60%',
                    data: pieData,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                    label: {
                        formatter: '{b}: {c} ({d}%)'
                    }
                }]
            };
            
            myChart.setOption(option);
            
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // ç”ŸæˆæŠ˜çº¿å›¾
        function generateLineChart(categories, values) {
            const chartDom = document.getElementById('line-chart');
            const myChart = echarts.init(chartDom);
            
            // ä½¿ç”¨ä¿®æ”¹åçš„å‡½æ•°åˆå¹¶æ•°æ®
            const mergedData = mergeData(categories, values);
            const mergedCategories = mergedData.categories;
            const mergedValues = mergedData.values;
            
            // è·å–åˆ—æ ‡ç­¾ä½œä¸ºè½´åç§°
            const categoryColumnIndex = parseInt(document.getElementById('category-column').value);
            const valueColumnIndex = parseInt(document.getElementById('value-column').value);
            const xAxisName = headers[categoryColumnIndex] || 'Xè½´';
            const yAxisName = headers[valueColumnIndex] || 'Yè½´';
            
            const option = {
                title: {
                    text: 'æ•°æ®åˆ†æç»“æœ',
                    left: 'center',
                    textStyle: {
                        fontSize: 16
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const param = params[0];
                        return `${param.name}: ${param.value} ${yAxisName}`;
                    }
                },
                grid: {
                    left: '5%',
                    right: '10%',  // å¢åŠ å³ä¾§ç©ºé—´ï¼Œä¸ºYè½´åç§°ç•™å‡ºä½ç½®
                    bottom: '10%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: mergedCategories,
                    axisLabel: {
                        rotate: 45,
                        interval: 0,
                        fontSize: 10
                    },
                    name: xAxisName,
                    nameLocation: 'end',  // ä¿®æ”¹ä¸ºæœ«ç«¯æ˜¾ç¤º
                    nameGap: 5,
                    nameTextStyle: {
                        fontWeight: 'bold',
                        fontSize: 12,
                        align: 'right',
                        verticalAlign: 'top'
                    }
                },
                yAxis: {
                    type: 'value',
                    name: yAxisName,
                    nameLocation: 'end',  // ä¿®æ”¹ä¸ºæœ«ç«¯æ˜¾ç¤º
                    nameGap: 15,
                    nameTextStyle: {
                        fontWeight: 'bold',
                        fontSize: 12,
                        padding: [0, 0, 5, 0]  // ä¸Šå³ä¸‹å·¦çš„å†…è¾¹è·
                    },
                    splitLine: {
                        lineStyle: {
                            type: 'dashed'
                        }
                    }
                },
                series: [{
                    name: yAxisName,
                    data: mergedValues,
                    type: 'line',
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 8,
                    itemStyle: {
                        color: '#5470c6'
                    },
                    lineStyle: {
                        width: 3
                    },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0,
                            y: 0,
                            x2: 0,
                            y2: 1,
                            colorStops: [{
                                offset: 0, color: 'rgba(84, 112, 198, 0.5)'
                            }, {
                                offset: 1, color: 'rgba(84, 112, 198, 0.1)'
                            }]
                        }
                    }
                }]
            };
            
            myChart.setOption(option);
            
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // ç”Ÿæˆæ•£ç‚¹å›¾
        function generateScatterChart(categories, values) {
            const chartDom = document.getElementById('scatter-chart');
            const myChart = echarts.init(chartDom);
            
            // ä½¿ç”¨ä¿®æ”¹åçš„å‡½æ•°åˆå¹¶æ•°æ®
            const mergedData = mergeData(categories, values);
            const mergedCategories = mergedData.categories;
            const mergedValues = mergedData.values;
            
            // è·å–åˆ—æ ‡ç­¾ä½œä¸ºè½´åç§°
            const categoryColumnIndex = parseInt(document.getElementById('category-column').value);
            const valueColumnIndex = parseInt(document.getElementById('value-column').value);
            const xAxisName = headers[categoryColumnIndex] || 'Xè½´';
            const yAxisName = headers[valueColumnIndex] || 'Yè½´';
            
            // å°†ç±»åˆ«å’Œå€¼ç»„åˆä¸ºæ•£ç‚¹å›¾æ‰€éœ€çš„æ•°æ®æ ¼å¼
            const scatterData = mergedCategories.map((cat, index) => {
                return [index, mergedValues[index]]; // ä½¿ç”¨ç´¢å¼•ä½œä¸ºXè½´ï¼Œå€¼ä½œä¸ºYè½´
            });
            
            const option = {
                title: {
                    text: 'æ•°æ®åˆ†æç»“æœ',
                    left: 'center',
                    textStyle: {
                        fontSize: 16
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: function(params) {
                        const categoryIndex = params.value[0];
                        return `${mergedCategories[categoryIndex]}: ${params.value[1]} ${yAxisName}`;
                    }
                },
                grid: {
                    left: '5%',
                    right: '10%',  // å¢åŠ å³ä¾§ç©ºé—´ï¼Œä¸ºYè½´åç§°ç•™å‡ºä½ç½®
                    bottom: '10%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: mergedCategories,
                    axisLabel: {
                        rotate: 45,
                        interval: 0,
                        fontSize: 10
                    },
                    name: xAxisName,
                    nameLocation: 'end',  // ä¿®æ”¹ä¸ºæœ«ç«¯æ˜¾ç¤º
                    nameGap: 5,
                    nameTextStyle: {
                        fontWeight: 'bold',
                        fontSize: 12,
                        align: 'right',
                        verticalAlign: 'top'
                    }
                },
                yAxis: {
                    type: 'value',
                    name: yAxisName,
                    nameLocation: 'end',  // ä¿®æ”¹ä¸ºæœ«ç«¯æ˜¾ç¤º
                    nameGap: 15,
                    nameTextStyle: {
                        fontWeight: 'bold',
                        fontSize: 12,
                        padding: [0, 0, 5, 0]  // ä¸Šå³ä¸‹å·¦çš„å†…è¾¹è·
                    },
                    splitLine: {
                        lineStyle: {
                            type: 'dashed'
                        }
                    }
                },
                series: [{
                    type: 'scatter',
                    name: yAxisName,
                    data: scatterData,
                    symbolSize: 12,
                    itemStyle: {
                        color: '#5470c6'
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.3)'
                        }
                    }
                }]
            };
            
            myChart.setOption(option);
            
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // ç”Ÿæˆé›·è¾¾å›¾
        function generateRadarChart(categories, values) {
            const chartDom = document.getElementById('radar-chart');
            const myChart = echarts.init(chartDom);
            
            // ä½¿ç”¨åˆå¹¶æ•°æ®å‡½æ•°
            const mergedData = mergeData(categories, values);
            const mergedCategories = mergedData.categories;
            const mergedValues = mergedData.values;
            
            // è·å–åˆ—æ ‡ç­¾ä½œä¸ºæ•°æ®åç§°
            const categoryColumnIndex = parseInt(document.getElementById('category-column').value);
            const valueColumnIndex = parseInt(document.getElementById('value-column').value);
            const xAxisName = headers[categoryColumnIndex] || 'Xè½´';
            const yAxisName = headers[valueColumnIndex] || 'Yè½´';
            
            // å‡†å¤‡é›·è¾¾å›¾æ•°æ®
            const indicator = mergedCategories.map((cat, index) => {
                // è®¡ç®—æœ€å¤§å€¼ä»¥åˆ›å»ºæ¯”ä¾‹å°º
                const max = Math.max(...mergedValues) * 1.2; // å¢åŠ 20%ä½™é‡
                return { name: cat, max: max };
            });
            
            const option = {
                title: {
                    text: 'æ•°æ®åˆ†æç»“æœ - é›·è¾¾å›¾',
                    left: 'center',
                },
                tooltip: {
                    trigger: 'item'
                },
                legend: {
                    data: [yAxisName],
                    bottom: 0
                },
                radar: {
                    indicator: indicator,
                    radius: '60%',
                    splitNumber: 5,
                    axisName: {
                        color: '#333',
                        fontSize: 10,
                        backgroundColor: '#eee',
                        borderRadius: 3,
                        padding: [3, 5]
                    }
                },
                series: [{
                    name: yAxisName,
                    type: 'radar',
                    data: [{
                        value: mergedValues,
                        name: yAxisName,
                        symbol: 'circle',
                        symbolSize: 6,
                        lineStyle: {
                            width: 2
                        },
                        areaStyle: {
                            opacity: 0.3
                        }
                    }]
                }]
            };
            
            myChart.setOption(option);
            
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // ç”Ÿæˆé¢ç§¯å›¾
        function generateAreaChart(categories, values) {
            const chartDom = document.getElementById('area-chart');
            const myChart = echarts.init(chartDom);
            
            // ä½¿ç”¨åˆå¹¶æ•°æ®å‡½æ•°
            const mergedData = mergeData(categories, values);
            const mergedCategories = mergedData.categories;
            const mergedValues = mergedData.values;
            
            // è·å–åˆ—æ ‡ç­¾ä½œä¸ºè½´åç§°
            const categoryColumnIndex = parseInt(document.getElementById('category-column').value);
            const valueColumnIndex = parseInt(document.getElementById('value-column').value);
            const xAxisName = headers[categoryColumnIndex] || 'Xè½´';
            const yAxisName = headers[valueColumnIndex] || 'Yè½´';
            
            const option = {
                title: {
                    text: 'æ•°æ®åˆ†æç»“æœ - é¢ç§¯å›¾',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        label: {
                            backgroundColor: '#6a7985'
                        }
                    }
                },
                legend: {
                    data: [yAxisName],
                    bottom: 0
                },
                grid: {
                    left: '5%',
                    right: '10%',
                    bottom: '10%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: mergedCategories,
                    name: xAxisName,
                    nameLocation: 'end',
                    nameGap: 5,
                    nameTextStyle: {
                        fontWeight: 'bold',
                        fontSize: 12,
                        align: 'right',
                        verticalAlign: 'top'
                    }
                },
                yAxis: {
                    type: 'value',
                    name: yAxisName,
                    nameLocation: 'end',
                    nameGap: 15,
                    nameTextStyle: {
                        fontWeight: 'bold',
                        fontSize: 12,
                        padding: [0, 0, 5, 0]
                    }
                },
                series: [{
                    name: yAxisName,
                    type: 'line',
                    stack: 'Total',
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0,
                            y: 0,
                            x2: 0,
                            y2: 1,
                            colorStops: [{
                                offset: 0, color: 'rgba(58, 71, 212, 0.8)'
                            }, {
                                offset: 1, color: 'rgba(58, 71, 212, 0.1)'
                            }]
                        }
                    },
                    emphasis: {
                        focus: 'series'
                    },
                    data: mergedValues,
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 6,
                    lineStyle: {
                        width: 3,
                        color: '#3a47d4'
                    },
                    itemStyle: {
                        color: '#3a47d4'
                    }
                }]
            };
            
            myChart.setOption(option);
            
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // ç”Ÿæˆæ—­æ—¥å›¾
        function generateSunburstChart(categories, values) {
            const chartDom = document.getElementById('sunburst-chart');
            const myChart = echarts.init(chartDom);
            
            // ä½¿ç”¨åˆå¹¶æ•°æ®å‡½æ•°
            const mergedData = mergeData(categories, values);
            const mergedCategories = mergedData.categories;
            const mergedValues = mergedData.values;
            
            // è·å–åˆ—æ ‡ç­¾ä½œä¸ºæ•°æ®åç§°
            const categoryColumnIndex = parseInt(document.getElementById('category-column').value);
            const valueColumnIndex = parseInt(document.getElementById('value-column').value);
            const categoryName = headers[categoryColumnIndex] || 'ç±»åˆ«';
            const valueName = headers[valueColumnIndex] || 'æ•°å€¼';
            
            // å‡†å¤‡æ—­æ—¥å›¾æ•°æ®
            const sunburstData = [];
            
            // æ‰€æœ‰æ•°æ®çš„æ€»å’Œï¼Œç”¨äºè®¡ç®—ç™¾åˆ†æ¯”
            const totalValue = mergedValues.reduce((a, b) => a + b, 0);
            
            // ç¬¬ä¸€çº§æ•°æ® - ä¸»è¦ç±»åˆ«ï¼ˆæ ¹æ®ç¬¬ä¸€ä¸ªå­—ç¬¦æˆ–å…¶ä»–è§„åˆ™åˆ†ç»„ï¼‰
            const mainGroups = {};
            
            mergedCategories.forEach((cat, index) => {
                // ç®€å•è§„åˆ™ï¼šæ ¹æ®é¦–å­—æ¯æˆ–æ•°å­—åˆ†ç»„
                const groupKey = cat.charAt(0).toUpperCase();
                
                if (!mainGroups[groupKey]) {
                    mainGroups[groupKey] = {
                        name: `${groupKey}ç»„`,
                        value: 0,
                        children: []
                    };
                    sunburstData.push(mainGroups[groupKey]);
                }
                
                // æ·»åŠ å­é¡¹
                mainGroups[groupKey].children.push({
                    name: cat,
                    value: mergedValues[index]
                });
                
                // æ›´æ–°ç»„æ€»å€¼
                mainGroups[groupKey].value += mergedValues[index];
            });
            
            const option = {
                title: {
                    text: 'æ•°æ®åˆ†æç»“æœ - æ—­æ—¥å›¾',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: function (params) {
                        const percent = ((params.value / totalValue) * 100).toFixed(1);
                        return `${params.name}: ${params.value} (${percent}%)`;
                    }
                },
                series: {
                    type: 'sunburst',
                    data: sunburstData,
                    radius: ['15%', '80%'],
                    label: {
                        rotate: 'radial'
                    },
                    levels: [
                        {}, // ç©ºå¯¹è±¡è¡¨ç¤ºä½¿ç”¨ç³»åˆ—çš„é»˜è®¤è®¾ç½®
                        {
                            r0: '15%',
                            r: '40%',
                            itemStyle: {
                                borderWidth: 2
                            },
                            label: {
                                rotate: 'tangential'
                            }
                        },
                        {
                            r0: '40%',
                            r: '80%',
                            label: {
                                align: 'right'
                            }
                        }
                    ]
                }
            };
            
            myChart.setOption(option);
            
            window.addEventListener('resize', function() {
                myChart.resize();
            });
        }
        
        // æ·»åŠ äº¤æ¢Xè½´å’ŒYè½´çš„åŠŸèƒ½
        document.getElementById('swap-axes-btn').addEventListener('click', function() {
            const categorySelect = document.getElementById('category-column');
            const valueSelect = document.getElementById('value-column');
            
            // ä¿å­˜å½“å‰é€‰æ‹©çš„å€¼
            const categoryValue = categorySelect.value;
            const valueValue = valueSelect.value;
            
            // äº¤æ¢å€¼
            categorySelect.value = valueValue;
            valueSelect.value = categoryValue;
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            this.classList.add('active');
            setTimeout(() => {
                this.classList.remove('active');
            }, 300);
        });
    </script>
</body>
</html>
